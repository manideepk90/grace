agent: Hyperswitch Agent
topic: Connector Integration
description: These are the mandatory rules and processes for integrating a new connector into the Hyperswitch system. Strict adherence is required.

# -------------------
# CORE PRINCIPLES
# -------------------
# These principles are non-negotiable and form the foundation of the integration process.
core_principles:
  - "[CRITICAL] Strict Adherence: All rules in this document are mandatory. Any deviation requires explicit, documented approval."
  - "[CRITICAL] Documentation First: All implementation details, errors, and learnings MUST be documented in the appropriate files BEFORE the task is considered complete."
  - "[CRITICAL] Incremental Updates: The knowledge base (errors.yaml, learnings.yaml, patterns.yaml) MUST be updated incrementally during the integration process, not just at the end."
# -------------------
# ONE-TIME SETUP
# -------------------
initial_step:
  - "[ONE-TIME SETUP] The `.clinerules` file MUST be located in the project root. If it is not, it must be moved there as the first action. Ignore if already present."

# -------------------
# GENERAL RULES
# -------------------
rules:
  - "[MANDATORY FIRST STEP] You MUST read and internalize ALL files within the `guides/` directory before initiating any integration work."
  - "[MANDATORY] All information and context for connector integration MUST be sourced exclusively from the `grace/` directory. No external references are permitted."
  - "[MANDATORY] A single file MUST NOT exceed 500 lines. For longer content, you MUST create continuation files using a `_part_N` suffix (e.g., `my_file_part_2.yaml`)."
  - "[MANDATORY] The `guides/` directory is a persistent knowledge base. Files and content within it MUST NOT be deleted or reset. Only additions are permitted."

# -------------------
# FILE STRUCTURE
# -------------------
# All files listed here are critical to the integration process.
structure:
  guides:
    - file: connector_integration_guide.yaml
      description: "[CRITICAL] Contains the step-by-step integration process. This guide is the source of truth and MUST be followed verbatim."
    - file: patterns/patterns.yaml
      description: "[MANDATORY] Contains common reusable patterns and solutions. You MUST consult this file to avoid re-implementing existing solutions."
    - file: errors/errors.yaml
      description: "[MANDATORY] Contains a log of common errors and their solutions. You MUST document all new errors encountered during implementation here."
    - file: learnings/learnings.yaml
      description: "[MANDATORY] Contains key lessons learned from previous integrations. You MUST contribute any new insights here."
    - file: types/types.yaml
      description: "[MANDATORY] Contains all data types used in the connector integrations. You MUST adhere to these types."
    - file: integrations/integrations.yaml
      description: "[MANDATORY] Contains knowledge from previous integrations. You MUST review this to understand established patterns before starting new work."
  connector_integration:
    - file: template/tech_spec.yaml
      description: "[TEMPLATE] Use this to create a technical specification for the new connector."
    - file: template/planner_steps.yaml
      description: "[TEMPLATE] Use this to outline the implementation steps for the new connector."

# -------------------
# INTEGRATION PROCESS
# -------------------
# The integration process is divided into distinct, sequential phases.
process:
  - "Phase 1: Planning & Specification"
  - "  - [MUST] Before writing any code, create a new directory: `connector_integration/<connector_name>/`."
  - "  - [MUST] Create `tech_spec.yaml` and `planner_steps.yaml` for the new connector using the provided templates."
  - "Phase 2: Implementation"
  - "  - [MUST] Follow the `connector_integration_guide.yaml` for the core implementation."
  - "  - [MUST] Immediately log all errors and their resolutions in `guides/errors/errors.yaml`."
  - "  - [MUST] Document any new reusable patterns in `guides/patterns/patterns.yaml`."
  - "  - [MUST] Record all significant takeaways in `guides/learnings/learnings.yaml`."
  - "Phase 3: Testing"
  - "  - [CRITICAL] All Cypress tests MUST be designed and validated against the `planner_steps.yaml` and `tech_spec.yaml` for the current integration."
  - "Phase 4: Finalization & Review"
  - "  - [MUST] Perform a final, thorough review of all `guides/` files to ensure they are up-to-date with the latest integration."
  - "  - [MUST] Verify that no rule in this document has been violated before completing the task."


# -------------------
# CONSEQUENCES
# -------------------
consequences:
  - "[WARNING] Failure to adhere to these rules will result in a mandatory reset of the workspace and a restart of the integration process from the last valid state."
